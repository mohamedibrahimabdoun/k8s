Cluster Setup:
--------------
* to us host network

docker network create \
  --driver=bridge \
  --subnet=192.168.4.0/24 \
  kind-network

 kind create cluster --config=istio-cluster.yaml  --name istio --network kind-network

 * local-host cluster 

 kind create cluster --config=istio-cluster.yaml 

 Install Calico CNI
 -------------------
 https://docs.tigera.io/calico/latest/getting-started/kubernetes/kind

 kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.29.1/manifests/calico.yaml

Installing Cilinum CNI
----------------------

helm repo add cilium https://helm.cilium.io/
helm repo update

helm upgrade --install cilium cilium/cilium --version 1.14.2 \
  --namespace kube-system \
  --set kubeProxyReplacement=strict \
  --set k8sServiceHost=192.168.4.40 \
  --set k8sServicePort=6443 \
  --set ipam.mode=kubernetes \
  --set nodePort.enabled=true \
  --set tunnel=geneve \
  --set bpf.masquerade=true \
  --set ipv4.enabled=true \
  --set ipv6.enabled=false \
  --set hubble.enabled=true \
  --set hubble.relay.enabled=true \
  --set hubble.ui.enabled=true

Install MetalLB:
---------------
helm repo add metallb https://metallb.github.io/metallb
helm repo update

helm install metallb metallb/metallb -n metallb-system --create-namespace

apiVersion: v1
kind: ConfigMap
metadata:
  namespace: metallb-system
  name: config
data:
  config: |
    address-pools:
    - name: default
      protocol: layer2
      addresses:
      - 192.168.4.50-192.168.4.100

kubectl apply -f metallb-config.yaml



 install ingress:
 --------------
  kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml

 Install Helm:
 --------------
 curl https://baltocdn.com/helm/signing.asc | gpg --dearmor | sudo tee /usr/share/keyrings/helm.gpg > /dev/null
sudo apt-get install apt-transport-https --yes
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
sudo apt-get update
sudo apt-get install helm

 Install prometheus:
  --------------

helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
helm install --create-namespace --namespace monitoring prometheus prometheus-community/prometheus

Install Grafana:
  --------------

helm repo add grafana https://grafana.github.io/helm-charts
helm repo update
helm install --namespace monitoring grafna grafana/grafana

kubectl get secret --namespace monitoring grafna-grafana -o jsonpath="{.data.admin-password}" | base64 --decode ; echo

     export POD_NAME=$(kubectl get pods --namespace monitoring -l "app.kubernetes.io/name=grafana,app.kubernetes.io/instance=grafna" -o jsonpath="{.items[0].metadata.name}")
     kubectl --namespace monitoring port-forward $POD_NAME 3000



Install istio:
--------------
helm repo add istio https://istio-release.storage.googleapis.com/charts
helm repo update

kubectl create namespace istio-system

helm install istio-base istio/base -n istio-system --version 1.23.0

helm install istiod istio/istiod -n istio-system \
  --version 1.23.0 \
  --set global.proxy.autoInject=enabled \
  --set global.proxy.privileged=true \
  --set meshConfig.accessLogFile="/dev/stdout"

helm install istio-ingressgateway istio/gateway -n istio-system --version 1.23.0

